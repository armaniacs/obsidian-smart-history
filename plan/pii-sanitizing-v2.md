# PII Sanitizing ä»•æ§˜æ›¸ v2

**æœ€çµ‚æ›´æ–°:** 2026-01-21

## å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

| Phase | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å®Œäº†æ—¥ |
|-------|-----------|--------|
| Phase 1: ãƒ­ãƒ¼ã‚«ãƒ«AIè¦ç´„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (L1) | âœ… å®Œäº† | å®Ÿè£…æ¸ˆã¿ |
| Phase 2: æ­£è¦è¡¨ç¾ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ (L2) | âœ… å®Œäº† | å®Ÿè£…æ¸ˆã¿ |
| Phase 3: ãƒ¢ãƒ¼ãƒ‰é¸æŠUIãƒ»è¨­å®šä¿å­˜ | âœ… å®Œäº† | å®Ÿè£…æ¸ˆã¿ |
| Phase 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªUI | âœ… å®Œäº† | å®Ÿè£…æ¸ˆã¿ |
| Phase 5: ãƒ­ã‚°æ©Ÿèƒ½ + 7æ—¥ä¿æŒ | âœ… å®Œäº† | å®Ÿè£…æ¸ˆã¿ |
| Phase 6: ãƒ†ã‚¹ãƒˆãƒ»èª¿æ•´ | âœ… å®Œäº† | æ¤œè¨¼æ¸ˆã¿ |

**å…¨ä½“é€²æ—**: 100% (6/6ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†)

---

## æ¦‚è¦

Webãƒšãƒ¼ã‚¸ã‚’Obsidianã«è¨˜éŒ²ã™ã‚‹éš›ã€ãƒ­ãƒ¼ã‚«ãƒ«AIã«ã‚ˆã‚‹è¦ç´„ã¨ã€PIIï¼ˆå€‹äººæƒ…å ±ï¼‰ãƒã‚¹ã‚­ãƒ³ã‚°æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¥½ã¿ã«å¿œã˜ã¦4ã¤ã®å‹•ä½œãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠå¯èƒ½ã«ã™ã‚‹ã€‚

---

## 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼š3ã¤ã®å‡¦ç†ãƒ¬ã‚¤ãƒ¤ãƒ¼

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | åç§° | å‡¦ç†å†…å®¹ | å¿…è¦æ¡ä»¶ |
|----------|------|----------|----------|
| **L1** | ãƒ­ãƒ¼ã‚«ãƒ«è¦ç´„ | `window.ai`ã§1è¡Œè¦ç´„ã‚’ç”Ÿæˆ | Edge/Chromeå†…è”µAI |
| **L2** | PIIãƒã‚¹ã‚­ãƒ³ã‚° | æ­£è¦è¡¨ç¾ + LLMè£œåŠ©ã§æ©Ÿå¯†æƒ…å ±ã‚’ãƒã‚¹ã‚¯ | â€” |
| **L3** | ã‚¯ãƒ©ã‚¦ãƒ‰è¦ç´„ | æ—¢å­˜`aiClient.js`ã§é«˜å“è³ªè¦ç´„ | API Key |

---

## 2. 4ã¤ã®å‹•ä½œãƒ¢ãƒ¼ãƒ‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mode A: Local Only          [L1ã®ã¿]                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ãƒšãƒ¼ã‚¸ â†’ ãƒ­ãƒ¼ã‚«ãƒ«AIè¦ç´„ â†’ Obsidianã«ä¿å­˜                     â”‚
â”‚  â€» ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æœ€å„ªå…ˆã€‚å¤–éƒ¨é€šä¿¡ãªã—                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mode B: Full Pipeline       [L1 â†’ L2 â†’ L3]                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ãƒšãƒ¼ã‚¸ â†’ ãƒ­ãƒ¼ã‚«ãƒ«è¦ç´„ â†’ PIIãƒã‚¹ã‚¯ â†’ ã‚¯ãƒ©ã‚¦ãƒ‰è¦ç´„ â†’ ä¿å­˜     â”‚
â”‚  â€» æœ€ã‚‚å®‰å…¨ã«é«˜å“è³ªãªè¦ç´„ã‚’å–å¾—                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mode C: Masked Cloud        [L2 â†’ L3]ï¼ˆL1ãªã—æ™‚è‡ªå‹•é©ç”¨ï¼‰      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ãƒšãƒ¼ã‚¸ â†’ PIIãƒã‚¹ã‚¯ï¼ˆRegexã®ã¿ï¼‰ â†’ ã‚¯ãƒ©ã‚¦ãƒ‰è¦ç´„ â†’ ä¿å­˜        â”‚
â”‚  â€» Firefoxç­‰ã€window.aiéå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ç”¨                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mode D: Cloud Only          [L3ã®ã¿]ï¼ˆç¾è¡Œå‹•ä½œï¼‰               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ãƒšãƒ¼ã‚¸ â†’ ã‚¯ãƒ©ã‚¦ãƒ‰è¦ç´„ â†’ ä¿å­˜                                  â”‚
â”‚  â€» æ—¢å­˜å‹•ä½œã€‚é€Ÿåº¦å„ªå…ˆãƒ»PIIä¿è­·ãªã—                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œ
- **Edge/Chromeï¼ˆwindow.aiå¯¾å¿œï¼‰:** Mode B
- **Firefoxç­‰ï¼ˆéå¯¾å¿œï¼‰:** Mode C
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¨­å®šç”»é¢ã§ãƒ¢ãƒ¼ãƒ‰ã‚’å¤‰æ›´å¯èƒ½

---

## 3. ä¿è­·å¯¾è±¡ã®å„ªå…ˆé †ä½ (L2: PIIãƒã‚¹ã‚­ãƒ³ã‚°)

| å„ªå…ˆåº¦ | æƒ…å ±ç¨®åˆ¥ | æ¤œå‡ºæ–¹æ³• |
|--------|----------|----------|
| **High** | ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç•ªå· | æ­£è¦è¡¨ç¾ï¼ˆLuhnæ¤œè¨¼ä»˜ãï¼‰ |
| **High** | ãƒã‚¤ãƒŠãƒ³ãƒãƒ¼ï¼ˆ12æ¡ï¼‰ | æ­£è¦è¡¨ç¾ |
| **High** | éŠ€è¡Œå£åº§ç•ªå· | æ­£è¦è¡¨ç¾ |
| **High** | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ï¼‰ | DOMå±æ€§æ¤œå‡º + æ­£è¦è¡¨ç¾ |
| Medium | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | æ­£è¦è¡¨ç¾ |
| Medium | é›»è©±ç•ªå·ï¼ˆæ—¥æœ¬å½¢å¼ï¼‰ | æ­£è¦è¡¨ç¾ |
| Low | äººå | ãƒ­ãƒ¼ã‚«ãƒ«LLMåˆ¤å®šã®ã¿ |
| Low | ä½æ‰€ | ãƒ­ãƒ¼ã‚«ãƒ«LLMåˆ¤å®šã®ã¿ |

> **è¨­è¨ˆæŒ‡é‡:** ã€Œ1è¡Œã«è¦ç´„ã™ã‚‹ã€ç›®çš„ã«ãŠã„ã¦ã€æ©Ÿå¯†æƒ…å ±ã¯ä¸è¦ã€‚ç©æ¥µçš„ã«ãƒã‚¹ã‚­ãƒ³ã‚°ã™ã‚‹ã€‚

---

## 4. PIIãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥ (L2å†…)

| Level | æ¡ä»¶ | å‡¦ç†å†…å®¹ | å®‰å…¨æ€§ |
|-------|------|----------|--------|
| **Level 1** | å†…è”µAIï¼ˆ`window.ai`ï¼‰åˆ©ç”¨å¯èƒ½ | LLMã§æ–‡è„ˆåˆ¤æ–­ + æ­£è¦è¡¨ç¾ã§é«˜å„ªå…ˆåº¦æƒ…å ±ã‚’ãƒã‚¹ã‚¯ | **æœ€é«˜** |
| **Level 2** | AIæœªæ­è¼‰ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­ | æ­£è¦è¡¨ç¾ã®ã¿ã§é«˜å„ªå…ˆåº¦æƒ…å ±ã‚’ãƒã‚¹ã‚¯ | **é«˜** |
| **Level 3** | ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°å¤±æ•— | é€ä¿¡ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ | **çµ¶å¯¾** |

---

## 5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªUI

### MVPä»•æ§˜
- ãƒã‚¹ã‚­ãƒ³ã‚°å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
- `[MASKED]`ç®‡æ‰€ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆå…ƒãƒ†ã‚­ã‚¹ãƒˆã¨ã®å·®åˆ†è¡¨ç¤ºï¼‰
- ã€Œé€ä¿¡ã€ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³

### å°†æ¥ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- ã€Œç¢ºèªãªã—ã§é€ä¿¡ã€è¨­å®šï¼ˆä¸Šç´šãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰
- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§æœ‰åŠ¹åŒ–

---

## 6. ãƒ­ã‚°æ©Ÿèƒ½

### ä¿å­˜å¯¾è±¡
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
- ãƒã‚¹ã‚­ãƒ³ã‚°çµæœï¼ˆä»¶æ•°ãƒ»ç¨®åˆ¥ï¼‰
- é€ä¿¡æˆå¦
- â€» ç”Ÿãƒ†ã‚­ã‚¹ãƒˆã¯**ä¿å­˜ã—ãªã„**

### ä¿æŒæœŸé–“
- ç›´è¿‘7æ—¥é–“
- 8æ—¥ç›®ä»¥é™ã¯è‡ªå‹•å‰Šé™¤

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- `chrome.storage.local`ã«ä¿å­˜
- ã‚­ãƒ¼: `pii_sanitize_logs`

---

## 6. æŠ€è¡“è¨­è¨ˆ

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**âœ… å®Œäº†**

```
src/
â”œâ”€â”€ background/
â”‚   â””â”€â”€ localAiClient.js   # âœ… L1: ãƒ­ãƒ¼ã‚«ãƒ«AIè¦ç´„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ piiSanitizer.js    # âœ… L2: PIIãƒã‚¹ã‚­ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â””â”€â”€ logger.js          # âœ… ãƒ­ã‚°æ©Ÿèƒ½
â”œâ”€â”€ popup/
â”‚   â””â”€â”€ sanitizePreview.js # âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªUI
â””â”€â”€ offscreen/
    â””â”€â”€ offscreen.html     # âœ… Offscreen Document
    â””â”€â”€ offscreen.js       # âœ… Chrome Prompt API ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
```

### æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**âœ… å®Œäº†**

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----------|----------|----------|
| `service-worker.js` | `processUrlRecording()`å†…ã§ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šãƒ»å„ãƒ¬ã‚¤ãƒ¤ãƒ¼å‘¼ã³å‡ºã— | âœ… å®Œäº† |
| `storage.js` | å‹•ä½œãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚­ãƒ¼ã€ãƒ­ã‚°ç®¡ç†ç”¨ã‚­ãƒ¼ã‚’è¿½åŠ  | âœ… å®Œäº† |
| `popup.html` | ãƒ¢ãƒ¼ãƒ‰é¸æŠUIã€ç¢ºèªUIã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  | âœ… å®Œäº† |
| `popup.js` | main.jsçµŒç”±ã§ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… | âœ… å®Œäº† |

---

## 8. æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆL2ç”¨ï¼‰

```javascript
const PII_PATTERNS = {
  // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆ16æ¡ã€ã‚¹ãƒšãƒ¼ã‚¹ãƒ»ãƒã‚¤ãƒ•ãƒ³è¨±å®¹ï¼‰
  creditCard: /\b(?:\d{4}[-\s]?){3}\d{4}\b/g,
  
  // ãƒã‚¤ãƒŠãƒ³ãƒãƒ¼ï¼ˆ12æ¡ï¼‰
  myNumber: /\b\d{4}[-\s]?\d{4}[-\s]?\d{4}\b/g,
  
  // éŠ€è¡Œå£åº§ï¼ˆ7æ¡ï¼‰
  bankAccount: /\b\d{7}\b/g,
  
  // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  email: /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,
  
  // é›»è©±ç•ªå·ï¼ˆæ—¥æœ¬å½¢å¼ï¼‰
  phoneJp: /\b0\d{1,4}[-\s]?\d{1,4}[-\s]?\d{4}\b/g,
};
```

---

## 9. ãƒ­ãƒ¼ã‚«ãƒ«AIï¼ˆwindow.aiï¼‰â€” L1è¦ç´„ & L2è£œåŠ©

### å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶
- **Edge** (å„ªå…ˆ) â€” Phi-4-mini
- **Chrome** â€” Gemini Nano

### åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰

```javascript
async function initLocalAI() {
  const capabilities = await window.ai?.languageModel?.capabilities();
  
  if (capabilities?.available === 'readily') {
    return await window.ai.languageModel.create({
      systemPrompt: `You are a privacy filter. 
        Identify and replace sensitive information with [MASKED].
        Sensitive info includes: names, addresses, emails, phone numbers.
        Keep all other text exactly as is.`
    });
  }
  return null; // Fallback to Level 2
}
```

---

## 10. å‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    A[ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å–å¾—] --> MODE{å‹•ä½œãƒ¢ãƒ¼ãƒ‰?}
    
    MODE -- Mode A --> L1A[L1: ãƒ­ãƒ¼ã‚«ãƒ«AIè¦ç´„]
    L1A --> SAVE[Obsidianã«ä¿å­˜]
    
    MODE -- Mode B --> L1B[L1: ãƒ­ãƒ¼ã‚«ãƒ«AIè¦ç´„]
    L1B --> L2B[L2: PIIãƒã‚¹ã‚¯]
    L2B --> CONFIRM{ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªUI}
    CONFIRM -- é€ä¿¡ --> L3B[L3: ã‚¯ãƒ©ã‚¦ãƒ‰è¦ç´„]
    CONFIRM -- ã‚­ãƒ£ãƒ³ã‚»ãƒ« --> CANCEL[å‡¦ç†ä¸­æ­¢]
    L3B --> SAVE
    
    MODE -- Mode C --> L2C[L2: PIIãƒã‚¹ã‚¯ Regexã®ã¿]
    L2C --> CONFIRM
    
    MODE -- Mode D --> L3D[L3: ã‚¯ãƒ©ã‚¦ãƒ‰è¦ç´„]
    L3D --> SAVE
    
    SAVE --> LOG[ãƒ­ã‚°è¨˜éŒ²]
    CANCEL --> LOG
    LOG --> END[å®Œäº†]
```

---

## 11. å°†æ¥æ‹¡å¼µ (TODO)

| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | å‚™è€ƒ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|--------|------|----------|
| ãƒ­ã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢UI | Low | ç¾æ™‚ç‚¹ã§ã¯ä¸è¦ã€‚å°†æ¥æ¤œè¨ | ğŸ“‹ æœªç€æ‰‹ |
| ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ | Low | JSONå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | ğŸ“‹ æœªç€æ‰‹ |

### æ±ºå®šäº‹é …
- **window.aiéå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆFirefoxç­‰ï¼‰** â†’ Mode Cï¼ˆL2â†’L3ï¼‰ã§å‹•ä½œ

---

## 12. å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆæ¡ˆï¼‰

| Phase | å†…å®¹ | å·¥æ•°ç›®å®‰ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|-------|------|----------|----------|
| Phase 1 | ãƒ­ãƒ¼ã‚«ãƒ«AIè¦ç´„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆL1ï¼‰ | 2æ™‚é–“ | âœ… å®Œäº† |
| Phase 2 | æ­£è¦è¡¨ç¾ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ï¼ˆL2ï¼‰ | 1-2æ™‚é–“ | âœ… å®Œäº† |
| Phase 3 | ãƒ¢ãƒ¼ãƒ‰é¸æŠUIãƒ»è¨­å®šä¿å­˜ | 1-2æ™‚é–“ | âœ… å®Œäº† |
| Phase 4 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªUI | 2-3æ™‚é–“ | âœ… å®Œäº† |
| Phase 5 | ãƒ­ã‚°æ©Ÿèƒ½ + 7æ—¥ä¿æŒ | 1æ™‚é–“ | âœ… å®Œäº† |
| Phase 6 | ãƒ†ã‚¹ãƒˆãƒ»èª¿æ•´ | 1-2æ™‚é–“ | âœ… å®Œäº† |

---

## ä»˜éŒ²: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®çµ±åˆãƒã‚¤ãƒ³ãƒˆ

### storage.js ã¸ã®è¿½åŠ 

```javascript
export const StorageKeys = {
  // æ—¢å­˜ã®ã‚­ãƒ¼...
  
  // PII Sanitizing é–¢é€£
  PRIVACY_MODE: 'privacy_mode',           // 'local_only' | 'full_pipeline' | 'masked_cloud' | 'cloud_only'
  PII_CONFIRMATION_UI: 'pii_confirmation_ui', // true | false
  PII_SANITIZE_LOGS: 'pii_sanitize_logs',
};

const DEFAULT_SETTINGS = {
  // æ—¢å­˜ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ...
  
  [StorageKeys.PRIVACY_MODE]: 'full_pipeline', // Mode B ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  [StorageKeys.PII_CONFIRMATION_UI]: true,
};
```

### service-worker.js processUrlRecording() çµ±åˆ

```javascript
async function processUrlRecording(data) {
  const { title, url, content, force = false } = data;
  const settings = await getSettings();
  const mode = settings[StorageKeys.PRIVACY_MODE];
  
  let summary = "Summary not available.";
  
  if (content) {
    switch (mode) {
      case 'local_only':       // Mode A
        summary = await localAiClient.summarize(content);
        break;
        
      case 'full_pipeline':    // Mode B
        const localSummary = await localAiClient.summarize(content);
        const sanitized = await piiSanitizer.sanitize(localSummary);
        if (!await confirmWithUser(sanitized)) return { cancelled: true };
        summary = await aiClient.generateSummary(sanitized.text);
        break;
        
      case 'masked_cloud':     // Mode C
        const sanitizedC = await piiSanitizer.sanitizeRegexOnly(content);
        if (!await confirmWithUser(sanitizedC)) return { cancelled: true };
        summary = await aiClient.generateSummary(sanitizedC.text);
        break;
        
      case 'cloud_only':       // Mode D (æ—¢å­˜å‹•ä½œ)
      default:
        summary = await aiClient.generateSummary(content);
        break;
    }
  }
  
  // æ—¢å­˜ã®ä¿å­˜å‡¦ç†...
}
```
