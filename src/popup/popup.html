<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Obsidian Smart History Settings</title>
  <style>
    body {
      width: 320px;
      padding: 15px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    h2 {
      font-size: 18px;
      margin-top: 0;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .icon-btn {
      width: 32px;
      height: 32px;
      background: #f5f5f5;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-btn:hover {
      background: #e0e0e0;
    }

    #currentPage {
      display: flex;
      align-items: center;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 10px;
      margin-bottom: 15px;
    }

    #favicon {
      margin-right: 10px;
    }

    #pageTitle {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 4px;
    }

    #pageUrl {
      font-size: 12px;
      color: #666;
      word-break: break-all;
    }

    .primary-btn {
      width: 100%;
      padding: 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .primary-btn:hover {
      background: #45a049;
    }

    .primary-btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }

    #mainStatus {
      margin-top: 10px;
      font-size: 12px;
      min-height: 1.2em;
      color: #333;
    }

    .form-group {
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-size: 12px;
      margin-bottom: 4px;
      color: #555;
    }

    input[type="text"],
    input[type="password"],
    textarea {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: inherit;
      font-size: 13px;
      resize: vertical;
    }

    button:not(.icon-btn):not(.primary-btn) {
      width: 100%;
      padding: 10px;
      background: #7b3cad;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    button:not(.icon-btn):not(.primary-btn):hover {
      background: #602a8c;
    }

    #status {
      margin-top: 10px;
      font-size: 12px;
      min-height: 1.2em;
      color: #333;
    }

    .success {
      color: green;
    }

    .error {
      color: red;
    }

    /* Tab Navigation */
    .tab-nav {
      display: flex;
      margin-bottom: 15px;
      border-bottom: 1px solid #ccc;
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }

    .tab-btn.active {
      border-bottom-color: #7b3cad;
      color: #7b3cad;
    }

    .tab-btn:hover {
      background: #f5f5f5;
    }

    .tab-panel {
      display: block;
    }

    .tab-panel:not(.active) {
      display: none;
    }

    /* Radio Group */
    .radio-group {
      margin-bottom: 10px;
    }

    .radio-group div {
      margin-bottom: 8px;
    }

    .radio-group input[type="radio"] {
      margin-right: 8px;
    }

    .radio-group label {
      display: inline;
      font-size: 13px;
    }

    /* Secondary Button */
    .secondary-btn {
      width: 100%;
      padding: 10px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
    }

    .secondary-btn:hover {
      background: #5a6268;
    }

    /* Help Text */
    .help-text {
      font-size: 11px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>

<body>
  <!-- Main Screen -->
  <div id="mainScreen" style="display: block;">
    <div class="header">
      <h2>Smart History</h2>
      <button id="menuBtn" class="icon-btn">‚ò∞</button>
    </div>

    <div id="currentPage">
      <img id="favicon" src="" width="16" height="16" alt="">
      <div id="pageInfo">
        <div id="pageTitle">Loading...</div>
        <div id="pageUrl">...</div>
      </div>
    </div>

    <button id="recordBtn" class="primary-btn">üìù ‰ªä„Åô„ÅêË®òÈå≤</button>
    <div id="mainStatus"></div>
  </div>

  <!-- Settings Screen -->
  <div id="settingsScreen" style="display: none;">
    <div class="header">
      <button id="backBtn" class="icon-btn">‚Üê</button>
      <h2>Settings</h2>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-nav">
      <button id="generalTab" class="tab-btn active">‰∏ÄËà¨</button>
      <button id="domainTab" class="tab-btn">„Éâ„É°„Ç§„É≥„Éï„Ç£„É´„Çø„Éº</button>
    </div>

    <!-- General Settings Panel -->
    <div id="generalPanel" class="tab-panel active">

    <div class="form-group">
    <label>Obsidian API Key</label>
    <input type="password" id="apiKey" placeholder="Paste your key here...">
  </div>

  <div class="form-group">
    <label>Protocol (http/https)</label>
    <input type="text" id="protocol" value="https">
  </div>

  <div class="form-group">
    <label>Port</label>
    <input type="text" id="port" value="27123">
  </div>

  <div class="form-group">
    <label>Daily Note Path</label>
    <input type="text" id="dailyPath" placeholder="e.g. 092.Daily">
  </div>

  <hr style="border: 0; border-top: 1px solid #ccc; margin: 15px 0;">

  <div class="form-group">
    <label>AI Provider</label>
    <select id="aiProvider">
      <option value="gemini">Google Gemini</option>
      <option value="openai">OpenAI Compatible (Groq, etc.)</option>
      <option value="openai2">OpenAI Compatible 2 (Local, etc.)</option>
    </select>
  </div>

  <!-- Gemini Settings -->
  <div id="geminiSettings">
    <div class="form-group">
      <label>Gemini API Key</label>
      <input type="password" id="geminiApiKey" placeholder="Paste your Gemini key here...">
    </div>

    <div class="form-group">
      <label>Model Name (e.g. gemini-1.5-flash)</label>
      <input type="text" id="geminiModel" value="gemini-1.5-flash">
    </div>
  </div>

  <!-- OpenAI Settings -->
  <div id="openaiSettings" style="display: none;">
    <div class="form-group">
      <label>Base URL</label>
      <input type="text" id="openaiBaseUrl" placeholder="https://api.openai.com/v1">
    </div>

    <div class="form-group">
      <label>API Key</label>
      <input type="password" id="openaiApiKey" placeholder="sk-...">
    </div>

    <div class="form-group">
      <label>Model Name</label>
      <input type="text" id="openaiModel" placeholder="gpt-3.5-turbo">
    </div>
  </div>

  <!-- OpenAI 2 Settings -->
  <div id="openai2Settings" style="display: none;">
    <div class="form-group">
      <label>Base URL</label>
      <input type="text" id="openai2BaseUrl" placeholder="http://127.0.0.1:11434/v1">
    </div>

    <div class="form-group">
      <label>API Key</label>
      <input type="password" id="openai2ApiKey" placeholder="Optional for some local LLMs">
    </div>

    <div class="form-group">
      <label>Model Name</label>
      <input type="text" id="openai2Model" placeholder="llama3">
    </div>
  </div>

  <div class="form-group">
    <label>Min Visit Duration (seconds)</label>
    <input type="number" id="minVisitDuration" min="1" value="5">
  </div>

  <div class="form-group">
    <label>Min Scroll Depth (%)</label>
    <input type="number" id="minScrollDepth" min="0" max="100" value="50">
  </div>

      <button id="save">Save & Test Connection</button>
      <div id="status"></div>
    </div>

    <!-- Domain Filter Panel -->
    <div id="domainPanel" class="tab-panel" style="display: none;">
      <div class="form-group">
        <label>„Éâ„É°„Ç§„É≥„Éï„Ç£„É´„Çø„Éº„É¢„Éº„Éâ</label>
        <div class="radio-group">
          <div>
            <input type="radio" id="filterDisabled" name="domainFilter" value="disabled">
            <label for="filterDisabled">ÁÑ°Âäπ („Åô„Åπ„Å¶Ë®òÈå≤)</label>
          </div>
          <div>
            <input type="radio" id="filterWhitelist" name="domainFilter" value="whitelist">
            <label for="filterWhitelist">„Éõ„ÉØ„Ç§„Éà„É™„Çπ„Éà (ÊåáÂÆö„Éâ„É°„Ç§„É≥„ÅÆ„ÅøË®òÈå≤)</label>
          </div>
          <div>
            <input type="radio" id="filterBlacklist" name="domainFilter" value="blacklist">
            <label for="filterBlacklist">„Éñ„É©„ÉÉ„ÇØ„É™„Çπ„Éà (ÊåáÂÆö„Éâ„É°„Ç§„É≥„ÇíÈô§Â§ñ)</label>
          </div>
        </div>
      </div>

      <div id="domainListSection">
        <div class="form-group">
          <label id="domainListLabel">„Éâ„É°„Ç§„É≥„É™„Çπ„Éà (1Ë°å„Å´1„Éâ„É°„Ç§„É≥)</label>
          <textarea id="domainList" rows="8" placeholder="example.com&#10;*.example.org&#10;company.net"></textarea>
          <div class="help-text">
            „ÉØ„Ç§„É´„Éâ„Ç´„Éº„Éâ„ÇÇ‰ΩøÁî®„Åß„Åç„Åæ„Åô (‰æã: *.example.com)
          </div>
        </div>
        
        <div class="form-group">
          <button id="addCurrentDomain" class="secondary-btn">ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏„Éâ„É°„Ç§„É≥„ÇíËøΩÂä†</button>
        </div>
      </div>

      <button id="saveDomainSettings">‰øùÂ≠ò</button>
      <div id="domainStatus"></div>
    </div>
  </div>

  <script type="module" src="navigation.js"></script>
  <script type="module" src="main.js"></script>
  <script type="module" src="popup.js"></script>
  <script type="module" src="domainFilter.js"></script>
</body>

</html>