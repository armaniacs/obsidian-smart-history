# UF-405: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå¯¾å¿œ - Redãƒ•ã‚§ãƒ¼ã‚º

## æ¦‚è¦

**ã€æ©Ÿèƒ½åã€‘**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå¯¾å¿œ (Ctrl+S / Cmd+S)

**TDDã‚¿ã‚¹ã‚¯ID**: UF-405

**ãƒ•ã‚§ãƒ¼ã‚º**: Redï¼ˆå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆä½œæˆï¼‰

**ä½œæˆæ—¥**: 2026-01-24

---

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
npm test -- src/background/__tests__/shortcutHandler.test.js
```

---

## æœŸå¾…ã•ã‚Œã‚‹å¤±æ•—

```
Cannot find module '../shortcut-handler.js' from 'shortcutHandler.test.js'
```

ã¾ãŸã¯

```
ReferenceError: handleQuickRecordCommand is not defined
```

---

## ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰

```javascript
/**
 * UF-405 ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå¯¾å¿œæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
 *
 * Redãƒ•ã‚§ãƒ¼ã‚º: å®Ÿè£…ã•ã‚Œã¦ã„ãªã„æ©Ÿèƒ½ã«é–¢ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
 * ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚³ãƒãƒ³ãƒ‰å—ä¿¡ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€æ’ä»–åˆ¶å¾¡ã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚
 */

import { describe, test, expect, beforeEach, afterEach } from '@jest/globals';
import { jest } from '@jest/globals';

// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚³ãƒãƒ³ãƒ‰å—ä¿¡ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€æ’ä»–åˆ¶å¾¡ã®ãƒ†ã‚¹ãƒˆ
// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æœªå®Ÿè£…ã®æ©Ÿèƒ½ãŒæ¤œå‡ºã•ã‚Œã‚‹ï¼ˆã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼‰
// ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.mdï¼‰ã«åŸºã¥ã

describe('ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (isHttpOrHttps)', () => {
  // ã€ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ç›®çš„ã€‘:
  //   - HTTP/HTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®åˆ¤å®šæ©Ÿèƒ½ã‚’æ¤œè¨¼
  //   - è¨˜éŒ²å¯¾è±¡URLã¨å¯¾è±¡å¤–URLã®æ­£ã—ã„åˆ†å²ã‚’ç¢ºèª
  // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: URLãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
  // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 114è¡Œç›®ã€HTTP/HTTPSã®ã¿è¨˜éŒ²ï¼‰

  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’åˆæœŸåŒ–
    // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€ãƒ†ã‚¹ãƒˆé–“ã®å¹²æ¸‰ã‚’é˜²æ­¢
    jest.clearAllMocks();
  });

  afterEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå¾Œå‡¦ç†ã€‘: ãƒ¢ãƒƒã‚¯ã®å¾©å…ƒ
    jest.restoreAllMocks();
  });

  // TC-002: HTTP/HTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒè¨˜éŒ²å¯¾è±¡ã¨ã—ã¦æ­£ã—ãåˆ¤å®šã•ã‚Œã‚‹
  test('isHttpOrHttps ã§ https URL ã‚’è¨˜éŒ²å¯¾è±¡ã¨ã—ã¦åˆ¤å®šã™ã‚‹', () => {
    // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: HTTPS URLãŒè¨˜éŒ²å¯¾è±¡ã¨ã—ã¦æ­£ã—ãåˆ¤å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: isHttpOrHttps('https://example.com')ã‚’å‘¼ã³å‡ºã—ã€trueãŒè¿”ã‚‹ã“ã¨ã‚’æ¤œè¨¼
    // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: HTTPS URLã®å ´åˆã€è¨˜éŒ²å¯¾è±¡ã¨ã—ã¦trueã‚’è¿”ã™
    // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 114è¡Œç›®ã€HTTP/HTTPSã®ã¿è¨˜éŒ²ï¼‰

    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: isHttpOrHttpsé–¢æ•°ã«HTTPS URLã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã—
    // ã€å‡¦ç†å†…å®¹ã€‘: URLãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    const result = isHttpOrHttps('https://example.com');

    // ã€çµæœæ¤œè¨¼ã€‘: trueãŒè¿”ã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€æœŸå¾…å€¤ç¢ºèªã€‘: HTTPS URLã¯è¨˜éŒ²å¯¾è±¡ã§ã‚ã‚‹ãŸã‚true
    expect(result).toBe(true); // ã€ç¢ºèªå†…å®¹ã€‘: HTTPS URLãŒè¨˜éŒ²å¯¾è±¡ã¨ã—ã¦åˆ¤å®šã•ã‚Œã‚‹ã“ã¨
  });

  test('isHttpOrHttps ã§ http URL ã‚’è¨˜éŒ²å¯¾è±¡ã¨ã—ã¦åˆ¤å®šã™ã‚‹', () => {
    // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: HTTP URLãŒè¨˜éŒ²å¯¾è±¡ã¨ã—ã¦æ­£ã—ãåˆ¤å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: isHttpOrHttps('http://example.com')ã‚’å‘¼ã³å‡ºã—ã€trueãŒè¿”ã‚‹ã“ã¨ã‚’æ¤œè¨¼
    // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: HTTP URLã®å ´åˆã€è¨˜éŒ²å¯¾è±¡ã¨ã—ã¦trueã‚’è¿”ã™
    // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 114è¡Œç›®ã€HTTP/HTTPSã®ã¿è¨˜éŒ²ï¼‰

    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: isHttpOrHttpsé–¢æ•°ã«HTTP URLã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã—
    // ã€å‡¦ç†å†…å®¹ã€‘: URLãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    const result = isHttpOrHttps('http://example.com');

    // ã€çµæœæ¤œè¨¼ã€‘: trueãŒè¿”ã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€æœŸå¾…å€¤ç¢ºèªã€‘: HTTP URLã¯è¨˜éŒ²å¯¾è±¡ã§ã‚ã‚‹ãŸã‚true
    expect(result).toBe(true); // ã€ç¢ºèªå†…å®¹ã€‘: HTTP URLãŒè¨˜éŒ²å¯¾è±¡ã¨ã—ã¦åˆ¤å®šã•ã‚Œã‚‹ã“ã¨
  });

  test('isHttpOrHttps ã§ chrome:// URL ã‚’è¨˜éŒ²å¯¾è±¡å¤–ã¨ã—ã¦åˆ¤å®šã™ã‚‹', () => {
    // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: chrome:// URLãŒè¨˜éŒ²å¯¾è±¡å¤–ã¨ã—ã¦æ­£ã—ãåˆ¤å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: isHttpOrHttps('chrome://extensions')ã‚’å‘¼ã³å‡ºã—ã€falseãŒè¿”ã‚‹ã“ã¨ã‚’æ¤œè¨¼
    // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: chrome:// URLã®å ´åˆã€è¨˜éŒ²å¯¾è±¡å¤–ã¨ã—ã¦falseã‚’è¿”ã™
    // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 155-158è¡Œç›®ã€è¨˜éŒ²å¯¾è±¡å¤–ã®ãƒšãƒ¼ã‚¸ï¼‰

    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: isHttpOrHttpsé–¢æ•°ã«chrome:// URLã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã—
    // ã€å‡¦ç†å†…å®¹ã€‘: URLãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    const result = isHttpOrHttps('chrome://extensions');

    // ã€çµæœæ¤œè¨¼ã€‘: falseãŒè¿”ã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€æœŸå¾…å€¤ç¢ºèªã€‘: chrome:// URLã¯è¨˜éŒ²å¯¾è±¡å¤–ã§ã‚ã‚‹ãŸã‚false
    expect(result).toBe(false); // ã€ç¢ºèªå†…å®¹ã€‘: chrome:// URLãŒè¨˜éŒ²å¯¾è±¡å¤–ã¨ã—ã¦åˆ¤å®šã•ã‚Œã‚‹ã“ã¨
  });

  test('isHttpOrHttps ã§ about:blank URL ã‚’è¨˜éŒ²å¯¾è±¡å¤–ã¨ã—ã¦åˆ¤å®šã™ã‚‹', () => {
    // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: about:blank URLãŒè¨˜éŒ²å¯¾è±¡å¤–ã¨ã—ã¦æ­£ã—ãåˆ¤å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€ãƒ†ã‚¹ãƒˆå†…å®¹**: isHttpOrHttps('about:blank')ã‚’å‘¼ã³å‡ºã—ã€falseãŒè¿”ã‚‹ã“ã¨ã‚’æ¤œè¨¼
    // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: about:blank URLã®å ´åˆã€è¨˜éŒ²å¯¾è±¡å¤–ã¨ã—ã¦falseã‚’è¿”ã™
    // ğŸŸ¡ è¦ä»¶å®šç¾©ã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆabout:blankãªã©ã®ç‰¹æ®Šãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: isHttpOrHttpsé–¢æ•°ã«about:blank URLã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã—
    // ã€å‡¦ç†å†…å®¹ã€‘: URLãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    const result = isHttpOrHttps('about:blank');

    // ã€çµæœæ¤œè¨¼ã€‘: falseãŒè¿”ã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€æœŸå¾…å€¤ç¢ºèªã€‘: about:blank URLã¯è¨˜éŒ²å¯¾è±¡å¤–ã§ã‚ã‚‹ãŸã‚false
    expect(result).toBe(false); // ã€ç¢ºèªå†…å®¹ã€‘: about:blank URLãŒè¨˜éŒ²å¯¾è±¡å¤–ã¨ã—ã¦åˆ¤å®šã•ã‚Œã‚‹ã“ã¨
  });
});

describe('æ’ä»–åˆ¶å¾¡ (recording status)', () => {
  // ã€ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ç›®çš„ã€‘:
  //   - é€£ç¶šå®Ÿè¡Œæ™‚ã®æ’ä»–åˆ¶å¾¡æ©Ÿèƒ½ã‚’æ¤œè¨¼
  //   - äºŒé‡è¨˜éŒ²é˜²æ­¢ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¢ºèª
  // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: è¨˜éŒ²çŠ¶æ…‹ç®¡ç†ãƒ•ãƒ©ã‚°ã®ãƒ†ã‚¹ãƒˆ
  // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 168-172è¡Œç›®ã€é€£ç¶šå®Ÿè¡Œã®æ’ä»–åˆ¶å¾¡ï¼‰

  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«è¨˜éŒ²çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
    // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: å‰ã®ãƒ†ã‚¹ãƒˆã®å½±éŸ¿ã‚’å—ã‘ãªã„ã‚ˆã†çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
    setRecordingStatus(false);
  });

  // TC-201: é€£ç¶šå®Ÿè¡Œæ™‚ã®æ’ä»–åˆ¶å¾¡
  test('isRecordingInProgress ã§è¨˜éŒ²çŠ¶æ…‹ã‚’æ­£ã—ãåˆ¤å®šã§ãã‚‹', () => {
    // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: è¨˜éŒ²ä¸­çŠ¶æ…‹ã®åˆ¤å®šæ©Ÿèƒ½ã‚’ç¢ºèª
    // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: setRecordingStatusã§è¨­å®šã—ãŸçŠ¶æ…‹ã‚’isRecordingInProgressã§åˆ¤å®š
    // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: è¨­å®šã—ãŸçŠ¶æ…‹ã«å¿œã˜ã¦æ­£ã—ã„å€¤ã‚’è¿”ã™
    // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 168-172è¡Œç›®ã€é€£ç¶šå®Ÿè¡Œã®æ’ä»–åˆ¶å¾¡ï¼‰

    // ã€åˆæœŸçŠ¶æ…‹ç¢ºèªã€‘: è¨˜éŒ²ä¸­ã§ãªã„çŠ¶æ…‹ã§ã‚ã‚‹ã“ã¨
    expect(isRecordingInProgress()).toBe(false); // ã€ç¢ºèªå†…å®¹ã€‘: åˆæœŸçŠ¶æ…‹ã§è¨˜éŒ²ä¸­ã§ãªã„ã“ã¨

    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: è¨˜éŒ²ä¸­çŠ¶æ…‹ã«è¨­å®š
    setRecordingStatus(true);
    expect(isRecordingInProgress()).toBe(true); // ã€å‰ææ¡ä»¶ç¢ºèªã€‘: è¨˜éŒ²ä¸­ã§ã‚ã‚‹ã“ã¨

    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: è¨˜éŒ²çŠ¶æ…‹ã‚’å–å¾—
    // ã€å‡¦ç†å†…å®¹ã€‘: ç¾åœ¨ã®è¨˜éŒ²çŠ¶æ…‹ãƒ•ãƒ©ã‚°ã‚’ç¢ºèª
    const result = isRecordingInProgress();

    // ã€çµæœæ¤œè¨¼ã€‘: trueãŒè¿”ã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(result).toBe(true); // ã€ç¢ºèªå†…å®¹ã€‘: è¨˜éŒ²ä¸­ã§ã‚ã‚‹ã“ã¨
  });

  test('è¨˜éŒ²ä¸­ã«å†åº¦ã‚³ãƒãƒ³ãƒ‰ã‚’å—ä¿¡ã™ã‚‹ã¨ç„¡è¦–ã•ã‚Œã‚‹', () => {
    // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: é€£ç¶šå®Ÿè¡Œæ™‚ã®æ’ä»–åˆ¶å¾¡å‹•ä½œã‚’ç¢ºèª
    // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: è¨˜éŒ²ä¸­ã«handleQuickRecordCommandã‚’å‘¼ã³å‡ºã—ã€å‡¦ç†ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼
    // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: è¨˜éŒ²ä¸­ã®å ´åˆã€å‡¦ç†ãŒè¡Œã‚ã‚Œãšæ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã™ã‚‹
    // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 168-172è¡Œç›®ã€é€£ç¶šå®Ÿè¡Œã®æ’ä»–åˆ¶å¾¡ï¼‰

    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: è¨˜éŒ²ä¸­çŠ¶æ…‹ã«è¨­å®š
    setRecordingStatus(true);

    // ã€åˆæœŸæ¡ä»¶ç¢ºèªã€‘: è¨˜éŒ²ä¸­ã§ã‚ã‚‹ã“ã¨
    expect(isRecordingInProgress()).toBe(true); // ã€å‰ææ¡ä»¶ç¢ºèªã€‘: è¨˜éŒ²ä¸­ã§ã‚ã‚‹ã“ã¨

    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: è¨˜éŒ²ä¸­ã«ã‚³ãƒãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè¡Œ
    // ã€å‡¦ç†å†…å®¹ã€‘: æ’ä»–åˆ¶å¾¡ã«ã‚ˆã‚‹å‡¦ç†ã‚¹ã‚­ãƒƒãƒ—ã‚’ç¢ºèª
    // â€»ã“ã®æ™‚ç‚¹ã§ã¯é–¢æ•°ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã‚’æœŸå¾…
    const result = handleQuickRecordCommand();

    // ã€çµæœæ¤œè¨¼ã€‘: å‡¦ç†ãŒæ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã—ãŸã“ã¨ã‚’ç¢ºèª
    // ã€æœŸå¾…å€¤ç¢ºèªã€‘: è¨˜éŒ²ä¸­ã®å ´åˆã€falseã¾ãŸã¯æ—©æœŸçµ‚äº†ã‚’è¿”ã™
    expect(result).toBe(false); // ã€ç¢ºèªå†…å®¹ã€‘: è¨˜éŒ²ä¸­ã®ãŸã‚å‡¦ç†ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚ŒãŸã“ã¨
  });
});

describe('ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚³ãƒãƒ³ãƒ‰å—ä¿¡åŸºæœ¬å‹•ä½œ', () => {
  // ã€ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ç›®çš„ã€‘:
  //   - ã‚³ãƒãƒ³ãƒ‰å—ä¿¡ã‹ã‚‰ã‚¿ãƒ–å–å¾—ã¾ã§ã®åŸºæœ¬ãƒ•ãƒ­ãƒ¼ã‚’æ¤œè¨¼
  //   - å„ç¨®ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®æŒ™å‹•ã‚’ç¢ºèª
  // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒãƒ³ãƒ‰ãƒ©ã®å…¨ä½“çš„ãªå‹•ä½œç¢ºèª
  // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 64-75è¡Œç›®ã€å…¥å‡ºåŠ›ã®é–¢ä¿‚æ€§ï¼‰

  // TC-001: ã‚³ãƒãƒ³ãƒ‰å—ä¿¡æ™‚ã®åŸºæœ¬å‹•ä½œï¼ˆP0ï¼‰
  test('ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€è¨˜éŒ²å‡¦ç†ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹', async () => {
    // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚³ãƒãƒ³ãƒ‰å—ä¿¡ã‹ã‚‰è¨˜éŒ²å‡¦ç†å‘¼ã³å‡ºã—ã¾ã§ã®æ­£å¸¸ãƒ•ãƒ­ãƒ¼ã‚’ç¢ºèª
    // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–å–å¾—å¾Œã€processUrlRecordingãŒå‘¼ã°ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼
    // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: chrome.tabs.queryã§ã‚¿ãƒ–ã‚’å–å¾—ã—ã€è¨˜éŒ²å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
    // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 64-75è¡Œç›®ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ï¼‰

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: Chrome APIã‚’ãƒ¢ãƒƒã‚¯
    global.chrome = {
      tabs: {
        query: jest.fn((queryInfo, callback) => {
          if (queryInfo.active) {
            callback([{ id: 123, url: 'https://example.com', title: 'Example Page' }]);
          }
        }),
        sendMessage: jest.fn((tabId, message, callback) => {
          callback({ content: 'ãƒšãƒ¼ã‚¸æœ¬æ–‡...' });
        })
      },
      commands: {
        onCommand: {
          addListener: jest.fn()
        }
      }
    };

    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ã‚³ãƒãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè¡Œ
    // ã€å‡¦ç†å†…å®¹ã€‘: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã®å–å¾—ã¨è¨˜éŒ²å‡¦ç†ã®å‘¼ã³å‡ºã—
    // â€»ã“ã®æ™‚ç‚¹ã§ã¯é–¢æ•°ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã‚’æœŸå¾…
    const result = await handleQuickRecordCommand();

    // ã€çµæœæ¤œè¨¼ã€‘: è¨˜éŒ²å‡¦ç†ãŒæˆåŠŸã—ãŸã“ã¨ã‚’ç¢ºèª
    // ã€æœŸå¾…å€¤ç¢ºèªã€‘: { success: true }ãŒè¿”ã‚‹
    expect(result).toEqual({ success: true }); // ã€ç¢ºèªå†…å®¹ã€‘: è¨˜éŒ²å‡¦ç†ãŒæˆåŠŸã—ãŸã“ã¨

    // ã€çµæœæ¤œè¨¼ã€‘: chrome.tabs.queryãŒå‘¼ã°ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    expect(chrome.tabs.query).toHaveBeenCalledWith(
      { active: true },
      expect.any(Function)
    ); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–å–å¾—ãŒè¡Œã‚ã‚ŒãŸã“ã¨
  });

  // TC-101: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ãŒå­˜åœ¨ã—ãªã„å ´åˆ
  test('ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™', async () => {
    // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ãŒãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç¢ºèª
    // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: chrome.tabs.queryãŒç©ºé…åˆ—ã‚’è¿”ã™å ´åˆã®æŒ™å‹•ã‚’æ¤œè¨¼
    // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å«ã‚€çµæœã‚’è¿”ã™
    // ğŸŸ¡ è¦ä»¶å®šç¾©ã®EDGE-001ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ãŒå­˜åœ¨ã—ãªã„ï¼‰ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ãŒãªã„çŠ¶æ³ã‚’ãƒ¢ãƒƒã‚¯
    global.chrome = {
      tabs: {
        query: jest.fn((queryInfo, callback) => {
          callback([]); // ç©ºé…åˆ— = ã‚¿ãƒ–ãªã—
        })
      }
    };

    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ã‚³ãƒãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè¡Œ
    // ã€å‡¦ç†å†…å®¹ã€‘: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ãªã—ã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    const result = await handleQuickRecordCommand();

    // ã€çµæœæ¤œè¨¼ã€‘: ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(result).toEqual({
      success: false,
      error: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'
    }); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ãŒãªã„ãŸã‚ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚‹ã“ã¨
  });

  // TC-102: HTTP/HTTPSä»¥å¤–ã®ãƒšãƒ¼ã‚¸
  test('HTTP/HTTPSä»¥å¤–ã®URLã®å ´åˆã€è¨˜éŒ²å¯¾è±¡å¤–ã¨ã—ã¦å‡¦ç†ã™ã‚‹', async () => {
    // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚‹ã‚¹ã‚­ãƒƒãƒ—å‡¦ç†ã‚’ç¢ºèª
    // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: chrome:// URLã®ã‚¿ãƒ–ã§ã‚³ãƒãƒ³ãƒ‰å—ä¿¡ã—ãŸå ´åˆã®æŒ™å‹•ã‚’æ¤œè¨¼
    // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: è¨˜éŒ²å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€é©åˆ‡ãªçµæœã‚’è¿”ã™
    // ğŸŸ¢ è¦ä»¶å®šç¾©ï¼ˆtdd-requirements.md 155-158è¡Œç›®ã€è¨˜éŒ²å¯¾è±¡å¤–ã®ãƒšãƒ¼ã‚¸ï¼‰

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒšãƒ¼ã‚¸ã®ã‚¿ãƒ–ã‚’ãƒ¢ãƒƒã‚¯
    global.chrome = {
      tabs: {
        query: jest.fn((queryInfo, callback) => {
          callback([{ id: 123, url: 'chrome://extensions', title: 'Extensions' }]);
        })
      }
    };

    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ã‚³ãƒãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè¡Œ
    // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚‹ã‚¹ã‚­ãƒƒãƒ—å‡¦ç†
    const result = await handleQuickRecordCommand();

    // ã€çµæœæ¤œè¨¼ã€‘: ã‚¹ã‚­ãƒƒãƒ—å‡¦ç†ãŒè¡Œã‚ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    expect(result).toEqual({
      success: false,
      error: 'ã“ã®ãƒšãƒ¼ã‚¸ã¯è¨˜éŒ²ã§ãã¾ã›ã‚“'
    }); // ã€ç¢ºèªå†…å®¹ã€‘: è¨˜éŒ²å¯¾è±¡å¤–ã®ãŸã‚å‡¦ç†ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚ŒãŸã“ã¨
  });
});

// ã€P1ãƒ»P2ãƒ†ã‚¹ãƒˆã¯Greenãƒ•ã‚§ãƒ¼ã‚ºå¾Œã«è¿½åŠ ã€‘
// Greenãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ã€Œã¨ã‚Šã‚ãˆãšå‹•ãã€ã“ã¨ãŒæœ€å„ªå…ˆ
// P1: TC-101, TC-102, TC-004
// P2: TC-003, TC-103, TC-202, TC-203
```

---

## æœªå®Ÿè£…é–¢æ•°ä¸€è¦§

ä»¥ä¸‹ã®é–¢æ•°ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ï¼š

| é–¢æ•°å | èª¬æ˜ | å¯¾å¿œãƒ†ã‚¹ãƒˆ |
|--------|------|-----------|
| `isHttpOrHttps(url)` | URLãŒHTTP/HTTPSã§ã‚ã‚‹ã‹åˆ¤å®šã™ã‚‹ | TC-002 |
| `isRecordingInProgress()` | ç¾åœ¨è¨˜éŒ²ä¸­ã‹åˆ¤å®šã™ã‚‹ | TC-201 |
| `setRecordingStatus(status)` | è¨˜éŒ²çŠ¶æ…‹ã‚’è¨­å®šã™ã‚‹ | TC-201 |
| `handleQuickRecordCommand()` | ã‚³ãƒãƒ³ãƒ‰å—ä¿¡æ™‚ã®ãƒ¡ã‚¤ãƒ³ãƒãƒ³ãƒ‰ãƒ© | TC-001, TC-101, TC-102 |

---

## Greenãƒ•ã‚§ãƒ¼ã‚ºã¸ã®è¦æ±‚äº‹é …

ä»¥ä¸‹ã®é–¢æ•°Â·ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

### 1. `src/background/shortcut-handler.js`ï¼ˆæ–°è¦ä½œæˆï¼‰

```javascript
/**
 * re-exportæœªå®Ÿè£…ã®é–¢æ•°ã‚’å®šç¾©
 * Greenãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ã™ã‚‹å†…å®¹:
 *   1. isHttpOrHttps(url) - URLãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒã‚§ãƒƒã‚¯
 *   2. isRecordingInProgress() - è¨˜éŒ²çŠ¶æ…‹åˆ¤å®š
 *   3. setRecordingStatus(status) - è¨˜éŒ²çŠ¶æ…‹è¨­å®š
 *   4. handleQuickRecordCommand() - ãƒ¡ã‚¤ãƒ³ãƒãƒ³ãƒ‰ãƒ©
 */
```

### 2. Chrome APIãƒ¢ãƒƒã‚¯ã®æ”¹å–„

- `chrome.tabs.query` ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œ
- `chrome.tabs.sendMessage` ã®ãƒ¢ãƒƒã‚¯è¿½åŠ 
- `chrome.notifications.create` ã®ãƒ¢ãƒƒã‚¯è¿½åŠ 

### 3. æ—¢å­˜`processUrlRecording`ã®çµ±åˆ

- `import { processUrlRecording } from './service-worker.js'`
- `handleQuickRecordCommand`å†…ã§å‘¼ã³å‡ºã—

---

## Greenãƒ•ã‚§ãƒ¼ã‚ºã®å®Ÿè£…æ–¹é‡

1. **ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å®Ÿè£…**:
   ```javascript
   export function isHttpOrHttps(url) {
     return url.startsWith('http://') || url.startsWith('https://');
   }
   ```

2. **æ’ä»–åˆ¶å¾¡å®Ÿè£…**:
   ```javascript
   let recordingInProgress = false;

   export function isRecordingInProgress() {
     return recordingInProgress;
   }

   export function setRecordingStatus(status) {
     recordingInProgress = status;
   }
   ```

3. **ãƒ¡ã‚¤ãƒ³ãƒãƒ³ãƒ‰ãƒ©å®Ÿè£…**:
   ```javascript
   export async function handleQuickRecordCommand() {
     // æ’ä»–åˆ¶å¾¡ãƒã‚§ãƒƒã‚¯
     if (isRecordingInProgress()) return { success: false };

     // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–å–å¾—
     // ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒã‚§ãƒƒã‚¯
     // è¨˜éŒ²å‡¦ç†å‘¼ã³å‡ºã—
   }
   ```