# PII Sanitization & Privacy Feature Walkthrough (v2.3)

Webページ要約時のプライバシー保護機能の実装ガイドです。

> [!NOTE]
> **Local AI機能について**
> Chrome/Edge等のブラウザにおける Prompt API (window.ai) の実装状況が過渡期であるため、**Mode A / Mode B は現在「開発中（実験的機能）」** と位置づけています。
> デフォルトでは **Mode C (Masked Cloud)** を使用することを強く推奨します。

## 主な機能

1.  **4つのプライバシーモード**: ユーザーのニーズに合わせて選択可能。
2.  **PIIマスキング**: クレジットカード番号、電話番号などの機密情報を正規表現で検出し `[MASKED]` に置換。
3.  **確認・編集プレビュー**: 送信前にマスク結果を確認・編集できるモーダルUI。
4.  **サニタイズログ**: マスキング履歴をローカルに記録（7日間保持）。

## 操作設定

### 推奨設定 (Mode C)

ポップアップの「プライバシー」タブから設定します。

| モード | ステータス | 動作説明 |
| :--- | :--- | :--- |
| **A: Local Only** | 🚧 開発中 | 完全ローカル処理。対応ブラウザでのみ動作。 |
| **B: Full Pipeline** | 🚧 開発中 | ローカル要約 + クラウド仕上げ。対応ブラウザでのみ動作。 |
| **C: Masked Cloud** | ✅ **推奨** | **PIIをマスクしてクラウドへ送信**。最も安定的かつ安全。 |
| **D: Cloud Only** | - | 従来動作。生データをクラウド送信。 |

### 動作フロー

1.  **「📝 今すぐ記録」** をクリック。
2.  **確認モーダル** が表示されます。
    - 本文中の電話番号などが `[MASKED:PHONE]` のように隠されていることを確認してください。
    - 必要に応じてテキストを編集できます。
3.  **「送信する」** をクリックしてObsidianへ保存します。

## v2.3の改善点（確認画面の使い勝手向上）

### 1. マスク種別の詳細表示

マスクされた個人情報の種別と件数がステータスメッセージに表示されるようになりました。

**表示例:**
```
電話番号3件をマスクしました
E-mail1件、クレジットカード番号2件をマスクしました
```

これで、どの種類の個人情報が検出されたかが一目で分かります。

### 2. マスク箇所へのワンタッチジャンプ

テキストエリアの右側に **▲ / ▼ ボタン** を追加しました。

**機能:**
- **▼ ボタン**: 次のマスク箇所（`[MASKED:*]`）に移動
- **▲ ボタン**: 前のマスク箇所に移動
- ジャンプ時に自動的にテキストを選択

長いテキストの中からマスク箇所を探す手間がなくなりました。

### 3. テキストエリアのリサイズ対応

テキストエリアのサイズを自由に調整できるようになりました。

**機能:**
- 右下のリサイズハンドルをドラッグしてサイズ変更
- デフォルト高さを200pxから600px（3倍）に拡大
- ポップアップのサイズ変更に合わせて自動調整

## 技術的詳細

### PII検出 (Regex)
以下のパターンを自動検出してマスクします：
- クレジットカード番号
- マイナンバー
- 銀行口座番号
- メールアドレス
- 日本の電話番号

### ログ確認
マスキングの実行ログを確認するには、拡張機能の DevTools コンソールで以下を実行します：
```javascript
await reviewLogs()
```

## 将来の展望
ブラウザの `window.ai` 実装が安定次第、Mode A/B のローカルAI機能が自動的に有効になる設計となっています。
